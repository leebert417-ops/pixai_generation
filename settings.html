<div class="pixai_settings">
  <div class="inline-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
      <b>
        <span data-i18n="PixAI Generation">PixAI Generation</span>
      </b>
      <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
    </div>
    <div class="inline-drawer-content">


      <!-- 代理服务器状态 -->
      <div style="background: rgba(0, 0, 0, 0.1); padding: 10px; border-radius: 5px; margin-bottom: 15px">
        <div style="display: flex; align-items: center; justify-content: space-between">
          <div>
            <strong>代理服务器状态</strong>
            <div id="pixai_proxy_status" style="margin-top: 5px; font-size: 0.9em">
              <span id="pixai_proxy_status_text" style="color: #888">未检测</span>
            </div>
          </div>
          <div style="display: flex; gap: 10px">
            <button id="pixai_check_proxy" type="button" class="menu_button" title="检查代理服务器状态">
              <i class="fa-solid fa-rotate"></i> 检查
            </button>
          </div>
        </div>
        <i style="display: block; margin-top: 8px; font-size: 0.85em; color: #888">
          请手动运行代理服务器 (node pixai_proxy.js)，然后点击“检查”按钮。
        </i>
      </div>

      <label for="pixai_api_key">
        <strong>PixAI API 密钥 (API Key)</strong>
      </label>
      <input id="pixai_api_key" type="password" class="text_pole" placeholder="输入您的 PixAI API 密钥" />
      <i>请在 PixAI 网站获取您的 API 令牌 (Bearer Token)</i>

      <hr />
      <h4 data-i18n="默认生成参数">默认生成参数</h4>

      <label for="pixai_model_id">默认模型 ID (Model ID)</label>
      <input id="pixai_model_id" type="text" class="text_pole" placeholder="例如: 1648918127446573124" />

      <label for="pixai_sampling_method">采样器 (Sampling Method)</label>
      <select id="pixai_sampling_method" class="text_pole">
        <option value="Euler a">Euler a</option>
        <option value="Euler">Euler</option>
        <option value="DPM++ 2M Karras" selected>DPM++ 2M Karras</option>
        <option value="DPM++ SDE Karras">DPM++ SDE Karras</option>
        <option value="DPM++ 2M SDE Karras">DPM++ 2M SDE Karras</option>
        <option value="DDIM">DDIM</option>
        <option value="PLMS">PLMS</option>
        <option value="UniPC">UniPC</option>
      </select>

      <label for="pixai_prompt_prefix">常见提示词前缀</label>
      <input
        id="pixai_prompt_prefix"
        type="text"
        class="text_pole"
        placeholder="best quality, absurdres, masterpiece,"
      />
      <i>这些词会自动添加到每次生成的提示词前面</i>

      <label for="pixai_negative_prompt">默认负面提示词</label>
      <textarea
        id="pixai_negative_prompt"
        class="text_pole textarea_compact autoSetHeight"
        placeholder="worst quality, low quality..."
      ></textarea>

      <hr />
      <h4>Lora 设置</h4>

      <label class="checkbox_label" for="pixai_use_lora">
        <input id="pixai_use_lora" type="checkbox" />
        <span>使用 Lora</span>
      </label>
      <i style="display: block; margin-top: 5px; color: #888"> 请检查您的订阅层级以确定您可以使用多少个 Lora </i>

      <div id="pixai_lora_settings" style="display: none; margin-top: 10px">
        <div id="pixai_lora_list"></div>

        <button id="pixai_add_lora" type="button" class="menu_button" style="margin-top: 10px">
          <i class="fa-solid fa-plus"></i> 添加 Lora
        </button>
      </div>

      <hr />

      <div class="flex-container">
        <div class="alignitemscenter flex-container flexFlowColumn flexGrow flexShrink gap0 flexBasis48p">
          <small>
            <span data-i18n="Sampling steps">Sampling steps</span>
          </small>
          <input
            class="neo-range-slider"
            type="range"
            id="pixai_steps"
            name="pixai_steps"
            min="1"
            max="50"
            step="1"
            value="20"
          />
          <input
            class="neo-range-input"
            type="number"
            id="pixai_steps_value"
            data-for="pixai_steps"
            min="1"
            max="50"
            step="1"
            value="20"
          />
        </div>

        <div class="alignitemscenter flex-container flexFlowColumn flexGrow flexShrink gap0 flexBasis48p">
          <small>
            <span data-i18n="CFG Scale">CFG Scale</span>
          </small>
          <input
            class="neo-range-slider"
            type="range"
            id="pixai_scale"
            name="pixai_scale"
            min="1"
            max="20"
            step="0.1"
            value="6.0"
          />
          <input
            class="neo-range-input"
            type="number"
            id="pixai_scale_value"
            data-for="pixai_scale"
            min="1"
            max="20"
            step="0.1"
            value="6.0"
          />
        </div>
      </div>

      <div id="pixai_dimensions_block" class="flex-container">
        <div class="alignitemscenter flex-container flexFlowColumn flexGrow flexShrink gap0 flexBasis48p">
          <small>
            <span data-i18n="Width">Width</span>
          </small>
          <input
            class="neo-range-slider"
            type="range"
            id="pixai_width"
            name="pixai_width"
            max="1024"
            min="64"
            step="64"
            value="512"
          />
          <input
            class="neo-range-input"
            type="number"
            id="pixai_width_value"
            data-for="pixai_width"
            max="1024"
            min="64"
            step="64"
            value="512"
          />
        </div>

        <div class="alignitemscenter flex-container flexFlowColumn flexGrow flexShrink gap0 flexBasis48p">
          <small>
            <span data-i18n="Height">Height</span>
          </small>
          <input
            class="neo-range-slider"
            type="range"
            id="pixai_height"
            name="pixai_height"
            max="1024"
            min="64"
            step="64"
            value="768"
          />
          <input
            class="neo-range-input"
            type="number"
            id="pixai_height_value"
            data-for="pixai_height"
            max="1024"
            min="64"
            step="64"
            value="768"
          />
        </div>
      </div>

      <hr />
      <!-- 自动生图设置 -->
      <div class="pixai_auto_gen_settings" style="border: 1px solid var(--inline-drawer-border-color); padding: 10px; border-radius: 5px; margin-bottom: 15px;">
        <h4>自动生图模式</h4>
        <label class="checkbox_label">
          <input id="pixai_auto_generation_enabled" type="checkbox" />
          <span>启用自动生图模式</span>
        </label>
        <i>启用后，拓展将自动检测 AI 回复中的图片标签并生成图片。</i>

        <div style="margin-top: 10px;">
          <label for="pixai_auto_gen_regex">图片标签正则表达式</label>
          <textarea id="pixai_auto_gen_regex" class="text_pole textarea_compact" rows="2"><pix\s+prompt="([^"]*)"[^>]*?>/g</textarea>
          <i>必须将提示词作为第一个捕获组。</i>
        </div>

        <!-- 提示词注入 -->
        <div style="margin-top: 10px;">
          <label class="checkbox_label">
            <input id="pixai_prompt_injection_enabled" type="checkbox" />
            <span>启用提示词注入</span>
          </label>
          <div id="pixai_prompt_injection_panel" style="display: none; margin-top: 5px;">
            <label for="pixai_prompt_injection_text">提示词注入内容</label>
            <textarea id="pixai_prompt_injection_text" class="text_pole textarea_compact" rows="3" placeholder="<image_generation>\nYou must insert a <pix prompt=\"example prompt\"> in the reply.\n</image_generation>"></textarea>
            <div class="flex-container flexnowrap" style="margin-top: 5px;">
              <label for="pixai_prompt_injection_position" class="flex1">注入位置</label>
              <select id="pixai_prompt_injection_position" class="text_pole widthNatural margin0">
                <option value="deep_system">@D ⚙️</option>
                <option value="deep_user">@D 👤</option>
                <option value="deep_assistant">@D 🤖</option>
              </select>
            </div>
            <div class="flex-container flexnowrap" style="margin-top: 5px;">
              <label for="pixai_prompt_injection_depth" class="flex1">注入深度</label>
              <input id="pixai_prompt_injection_depth" class="text_pole widthUnset" type="number" min="0" value="0">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
